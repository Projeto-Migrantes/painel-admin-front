<%- include("../partials/header.ejs") %>
<body>
  <%- include("../partials/navbar.ejs") %>
  <br><br>
  <div class="container mt-5 mb-4">
    <h1 class="mt-4 mb-3 text-primary">
      <i class="bi bi-building-gear"></i> Editar Instituição
    </h1>

    <div id="alert" class="alert alert-danger d-none" role="alert"></div>

    <form action="/dashboard/institution/update" method="POST">
      <input type="hidden" name="institution_id" value="<%= institution.id %>">

      <div class="form-group">
        <label for="name">Nome da Instituição*</label>
        <input type="text" class="form-control" id="name" name="name" required maxlength="200" value="<%= institution.name %>">
      </div>

      <div class="form-group">
        <label for="cnpj">CNPJ*</label>
        <input type="text" class="form-control" id="cnpj" name="cnpj" required maxlength="18" oninput="formatCNPJ(this)" value="<%= institution.cnpj %>">
      </div>

      <div class="form-group">
        <label for="email">Email*</label>
        <input type="email" class="form-control" id="email" name="email" required maxlength="100" value="<%= institution.email %>">
        <div id="emailFeedback"></div>
      </div>

      <div class="form-group">
        <label for="main_phone">Telefone Principal*</label>
        <input type="text" class="form-control" id="main_phone" required name="main_phone" oninput="formatPhone(this)" maxlength="15" value="<%= institution.main_phone %>">
      </div>

      <div class="form-group">
        <label for="secondary_phone">Telefone Secundário</label>
        <input type="text" class="form-control" id="secondary_phone" name="secondary_phone" oninput="formatPhone(this)" maxlength="15" value="<%= institution.secondary_phone || '' %>">
      </div>

      <div class="form-group">
        <label for="website">Site</label>
        <input type="text" class="form-control" id="website" name="website" maxlength="500" value="<%= institution.website || '' %>">
      </div>

      <div class="form-group">
        <label for="institution_category">Categoria*</label>
        <select class="form-control" id="institution_category" name="institution_category" required>
          <option value="" disabled>Selecione uma categoria</option>
          <% categories.forEach(category => { %>
            <% if (category.category_pt !== "Todas Categorias") { %>
              <option value="<%= category.id %>" <%= institution.category_id === category.id ? 'selected' : '' %>><%= category.category_pt %></option>
            <% } %>
          <% }); %>
        </select>
      </div>

      <div class="form-group">
        <label for="instagram">Instagram</label>
        <input type="text" class="form-control" id="instagram" name="instagram" oninput="formatInstagramUsername(this)" maxlength="70" value="<%= institution.instagram || '' %>">
      </div>

      <div class="form-group">
        <label for="link_maps">Link do Maps*</label>
        <input type="text" class="form-control" id="link_maps" required name="link_maps" maxlength="1000" value="<%= institution.link_maps %>">
      </div>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-postcard-fill"></i> Descrição da Instituição
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="institution_description_<%= lang %>">Descrição (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="institution_description_<%= lang %>" required name="institution_description_<%= lang %>" rows="3" maxlength="255"><%= institution[`institution_description_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-clock-fill"></i> Dias e Horários de Funcionamento
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="service_hours_<%= lang %>">Horários (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="service_hours_<%= lang %>" required name="service_hours_<%= lang %>" rows="3" maxlength="255"><%= institution[`service_hours_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-people-fill"></i> População Alvo
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="target_populations_<%= lang %>">População Alvo (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="target_populations_<%= lang %>" required name="target_populations_<%= lang %>" rows="3" maxlength="255"><%= institution[`target_populations_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-check-circle-fill"></i> Requisitos e Restrições
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="requirements_restrictions_<%= lang %>">Requisitos e Restrições (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="requirements_restrictions_<%= lang %>" required name="requirements_restrictions_<%= lang %>" rows="3" maxlength="255"><%= institution[`requirements_restrictions_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-box-fill"></i> Serviços Oferecidos
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="services_offered_<%= lang %>">Serviços Oferecidos (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="services_offered_<%= lang %>" required name="services_offered_<%= lang %>" rows="3" maxlength="255"><%= institution[`services_offered_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-currency-dollar"></i> Custos dos Serviços
      </h3>
      <% ['pt','en','fr','es'].forEach(lang => { %>
        <div class="form-group">
          <label for="service_costs_<%= lang %>">Custos dos Serviços (<%= lang.toUpperCase() %>)*</label>
          <textarea class="form-control" id="service_costs_<%= lang %>" required name="service_costs_<%= lang %>" rows="3" maxlength="255"><%= institution[`service_costs_${lang}`] || '' %></textarea>
        </div>
      <% }) %>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-geo-alt-fill"></i> Endereço
      </h3>
      <div class="form-group">
        <label for="postal_code">CEP*</label>
        <input type="text" class="form-control" id="postal_code" name="postal_code" required oninput="formatCEP(this)" maxlength="9" value="<%= institution.address.postal_code %>">
        <button type="button" id="btnBuscarEndereco" class="btn btn-primary mt-2">Buscar Endereço</button>
      </div>

      <div class="form-group">
        <label for="street">Logradouro*</label>
        <input type="text" class="form-control" id="street" required name="street" maxlength="255" value="<%= institution.address.street %>">
      </div>

      <div class="form-group">
        <label for="neighborhood">Bairro*</label>
        <input type="text" class="form-control" id="neighborhood" required name="neighborhood" maxlength="255" value="<%= institution.address.neighborhood %>">
      </div>

      <div class="form-group">
        <label for="city">Cidade*</label>
        <input type="text" class="form-control" id="city" required name="city" maxlength="150" value="<%= institution.address.city %>">
      </div>

      <div class="form-group">
        <label for="state">Estado*</label>
        <input type="text" class="form-control" id="state" required name="state" maxlength="150" value="<%= institution.address.state %>">
      </div>

      <div class="form-group">
        <label for="numero">Número*</label>
        <input type="text" class="form-control" id="numero" name="numero" maxlength="10" required value="<%= institution.address_number %>">
      </div>

      <div class="form-group">
        <label for="complemento">Complemento</label>
        <input type="text" class="form-control" id="complemento" name="complemento" maxlength="240" value="<%= institution.address_complement || '' %>">
      </div>

      <hr>
      <h3 class="mt-4 text-primary">
        <i class="bi bi-person-fill"></i> Responsável Pelo Cadastro
      </h3>
      <div class="form-group">
        <label for="responsible_user_name">Nome do Responsável*</label>
        <input type="text" class="form-control" id="responsible_user_name" name="responsible_user_name" required maxlength="255" value="<%= institution.responsible_user_name %>">
      </div>

      <div class="form-group">
        <label for="responsible_user_position">Posição*</label>
        <input type="text" class="form-control" id="responsible_user_position" name="responsible_user_position" required maxlength="80" value="<%= institution.responsible_user_position %>">
      </div>

      <div class="form-group">
        <label for="responsible_user_sector">Setor*</label>
        <input type="text" class="form-control" id="responsible_user_sector" name="responsible_user_sector" required maxlength="80" value="<%= institution.responsible_user_sector %>">
      </div>

      <div class="form-group">
        <label for="responsible_user_role">Função*</label>
        <input type="text" class="form-control" id="responsible_user_role" name="responsible_user_role" required maxlength="80" value="<%= institution.responsible_user_role %>">
      </div>

      <div class="form-check mb-3">
        <input type="checkbox" class="form-check-input" id="terms" name="authorized" <%= institution.authorized ? 'checked' : '' %>>
        <label class="form-check-label" for="terms">A instituição aceita os <a href="/terms/instituicao" target="_blank">Termos e Condições</a></label>
      </div>

      <button type="submit" class="btn btn-success">
        <i class="bi bi-save"></i> Salvar Alterações
      </button>
      <a href="/dashboard/institutions" class="btn btn-secondary">
        <i class="bi bi-x-lg"></i> Cancelar
      </a>
    </form>
  </div>

  <%- include("../partials/footer.ejs") %>
  <script src="/js/scriptInstitutionEdit.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
</html>
