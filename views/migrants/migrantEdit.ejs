<%- include("../partials/header.ejs") %>
<body>
    <%- include("../partials/navbar.ejs") %>
    <br><br>
    <div class="container mt-5 mb-4">
        <h1 class="mt-3 mb-3 text-primary">
        <i class="bi bi-pencil-square"></i> Editar Migrante
        </h1>

        <div id="alert" class="alert alert-danger d-none" role="alert"></div>

        <form action="/dashboard/migrants/update" method="POST">
        <div class="form-group">
            <label for="full_name">Nome Completo*</label>
            <input type="text" class="form-control" id="full_name" maxlength="150" name="full_name" required value="<%= migrant.full_name %>">
        </div>

        <div class="form-group">
            <label for="social_name">Nome Social</label>
            <input type="text" class="form-control" id="social_name" maxlength="150" name="social_name" value="<%= migrant.social_name || '' %>">
        </div>

        <div class="form-group">
            <label for="gender">Gênero*</label>
            <select class="form-control" id="gender" name="gender" required>
            <option value="" disabled <%= !migrant.gender ? 'selected' : '' %>>Selecione uma opção</option>
            <option value="Masculino" <%= migrant.gender === 'Masculino' ? 'selected' : '' %>>Masculino</option>
            <option value="Feminino" <%= migrant.gender === 'Feminino' ? 'selected' : '' %>>Feminino</option>
            <option value="Não-binário" <%= migrant.gender === 'Não-binário' ? 'selected' : '' %>>Não-binário</option>
            <option value="Transfeminino" <%= migrant.gender === 'Transfeminino' ? 'selected' : '' %>>Transfeminino</option>
            <option value="Transmasculino" <%= migrant.gender === 'Transmasculino' ? 'selected' : '' %>>Transmasculino</option>
            <option value="Agênero" <%= migrant.gender === 'Agênero' ? 'selected' : '' %>>Agênero</option>
            <option value="Gênero Fluido" <%= migrant.gender === 'Gênero Fluido' ? 'selected' : '' %>>Gênero Fluido</option>
            <option value="Prefiro não informar" <%= migrant.gender === 'Prefiro não informar' ? 'selected' : '' %>>Prefiro não informar</option>
            <option value="Outro" <%= migrant.gender === 'Outro' ? 'selected' : '' %>>Outro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="email">Email*</label>
            <input type="email" class="form-control" id="email" maxlength="100" required name="email" value="<%= migrant.email %>">
            <div id="emailFeedback"></div>
        </div>

        <div class="form-group">
            <label for="phone_number">Telefone</label>
            <input type="text" class="form-control" id="phone_number" maxlength="15" name="phone_number" value="<%= migrant.phone_number || '' %>">
        </div>

        <!-- <div class="form-group">
            <label for="whatsapp_number">Número do WhatsApp?*</label>
            <select class="form-control" id="whatsapp_number" name="whatsapp_number" required>
            <option value="" disabled <%= migrant.whatsapp_number == null ? 'selected' : '' %>>Selecione</option>
            <option value=true <%= migrant.whatsapp_number === true ? 'selected' : '' %>>Sim</option>
            <option value=false <%= migrant.whatsapp_number === false ? 'selected' : '' %>>Não</option>
            </select>
        </div> -->

        <div class="form-group">
            <label for="crnm">CRNM</label>
            <input type="text" class="form-control" id="crnm" name="crnm" maxlength="50" value="<%= migrant.crnm || '' %>">
        </div>

        <div class="form-group">
            <label for="date_of_birth">Data de Nascimento*</label>
            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required value="<%= migrant.date_of_birth ? migrant.date_of_birth.substring(0,10) : '' %>">
        </div>

        <div class="form-group">
            <label for="language_preference">Idioma Preferido*</label>
            <input type="text" class="form-control" id="language_preference" maxlength="100" name="language_preference" required value="<%= migrant.language_preference || '' %>">
        </div>

        <div class="form-group">
            <label for="entry_into_brazil">Data de Entrada no Brasil*</label>
            <input type="date" class="form-control" id="entry_into_brazil" name="entry_into_brazil" required value="<%= migrant.entry_into_brazil ? migrant.entry_into_brazil.substring(0,10) : '' %>">
        </div>

        <div class="form-group">
            <label for="migration_reason">Razão de Imigração*</label>
            <input type="text" class="form-control" id="migration_reason" maxlength="240" name="migration_reason" required value="<%= migrant.migration_reason || '' %>">
        </div>

        <div class="form-group">
            <label for="country_of_origin">País de Origem*</label>
            <input type="text" class="form-control" id="country_of_origin" maxlength="120" name="country_of_origin" required value="<%= migrant.country_of_origin || '' %>">
        </div>

        <div class="form-group">
            <label for="marital_status">Estado Civil*</label>
            <select class="form-control" id="marital_status" name="marital_status" required>
            <option value="" disabled <%= !migrant.marital_status ? 'selected' : '' %>>Selecione</option>
            <option value="Solteiro" <%= migrant.marital_status === 'Solteiro' ? 'selected' : '' %>>Solteiro</option>
            <option value="Casado" <%= migrant.marital_status === 'Casado' ? 'selected' : '' %>>Casado</option>
            <option value="Separado" <%= migrant.marital_status === 'Separado' ? 'selected' : '' %>>Separado</option>
            <option value="Divorciado" <%= migrant.marital_status === 'Divorciado' ? 'selected' : '' %>>Divorciado</option>
            <option value="Viúvo" <%= migrant.marital_status === 'Viúvo' ? 'selected' : '' %>>Viúvo</option>
            <option value="Prefiro não informar" <%= migrant.marital_status === 'Prefiro não informar' ? 'selected' : '' %>>Prefiro não informar</option>
            </select>
        </div>

        <div class="form-group">
            <label for="literacy_level">Escolaridade*</label>
            <input type="text" class="form-control" id="literacy_level" maxlength="150" name="literacy_level" required value="<%= migrant.literacy_level || '' %>">
        </div>

        <hr>
        <h3 class="mt-4 text-primary">
            <i class="bi bi-geo-alt-fill"></i> Endereço
        </h3>

        <div class="form-group">
            <label for="postal_code">CEP*</label>
            <input type="text" class="form-control" id="postal_code" name="postal_code" maxlength="9" required value="<%= migrant.address.postal_code || '' %>">
            <button type="button" id="btnBuscarEndereco" class="btn btn-primary mt-2">Buscar Endereço</button>
        </div>

        <div class="form-group">
            <label for="street">Logradouro*</label>
            <input type="text" class="form-control" id="street" name="street" maxlength="255" required value="<%= migrant.address.street || '' %>">
        </div>

        <div class="form-group">
            <label for="neighborhood">Bairro*</label>
            <input type="text" class="form-control" id="neighborhood" name="neighborhood" maxlength="255" required value="<%= migrant.address.neighborhood || '' %>">
        </div>

        <div class="form-group">
            <label for="city">Cidade*</label>
            <input type="text" class="form-control" id="city" name="city" maxlength="150" required value="<%= migrant.address.city || '' %>">
        </div>

        <div class="form-group">
            <label for="state">Estado*</label>
            <input type="text" class="form-control" id="state" name="state" maxlength="150" required value="<%= migrant.address.state || '' %>">
        </div>

        <div class="form-group">
            <label for="address_number">Número*</label>
            <input type="text" class="form-control" id="address_number" name="address_number" maxlength="10" required value="<%= migrant.address_number || '' %>">
        </div>

        <div class="form-group">
            <label for="address_complement">Complemento</label>
            <input type="text" class="form-control" id="address_complement" name="address_complement" maxlength="240" value="<%= migrant.address_complement || '' %>">
        </div>

        <input type="hidden" name="migrant_id" value="<%= migrant.id %>">

        <div class="mt-4">
            <button type="submit" class="btn btn-success">
            <i class="bi bi-person"></i> Salvar Alterações
            </button>
            <a href="/dashboard/migrants" class="btn btn-secondary">
            <i class="bi bi-x-lg"></i> Cancelar
            </a>
        </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/scriptMigrantEdit.js"></script>
    <%- include("../partials/footer.ejs") %>
</body>
</html>
